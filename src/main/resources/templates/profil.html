<!DOCTYPE html>

<meta name="_csrf" th:content="${_csrf.token}"/>
<meta name="_csrf_header" th:content="${_csrf.headerName}"/>

<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title>Portfolios</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div id="adminHeaderContainer"></div>
<h1>Mon profil</h1>
<h3 class="username-display" th:text="${user.username}">Titre du projet</h3>
<form th:attr="data-user-id=${user.id}" onsubmit="event.preventDefault(); modifyUserInfo(this);">
    <div><label>username: <input type="text" name="username" th:value="${user.username}"/></label></div>
    <input type="hidden" name="id" th:value="${user.id}"/>
    <div><input type="submit" value="modifier"/></div>
</form>


</body>

<script>
    function modifyUserInfo(form){
        const formData = $(form).serialize();
        const userId = $(form).find("input[name='id']").val();

        const csrfToken = $("meta[name='_csrf']").attr("content");
        const csrfHeader = $("meta[name='_csrf_header']").attr("content");

        $.ajax({
            url: '/user/modif',
            type: 'PUT',
            data: formData,
            beforeSend: function(xhr) {
                xhr.setRequestHeader(csrfHeader, csrfToken);
            },
            success: function(response) {
                $('.username-display').text($(form).find("input[name='username']").val());
            },
            error: function(error) {
                console.error("erreur lors de la mise Ã  jour du pojet", error);
            }
        })
    }
</script>

